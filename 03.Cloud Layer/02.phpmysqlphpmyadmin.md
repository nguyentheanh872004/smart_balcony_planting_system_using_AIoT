## Setup Inbound rules và Outbound rules EC2 Cloud
- Inbound rules (LUỒNG VÀO): Ai được phép đi VÀO EC2 của bạn:
  - Internet → EC2
  - Máy bạn → EC2
  - Gateway IoT → EC2
- Outbound rules (LUỒNG RA)
  - EC2 → Internet
  - EC2 → server khác
  - EC2 → API, MQTT broker ngoài
## 1) Chuẩn bị & kiểm tra hệ thống
Cập nhật apt:
```bash
sudo apt update && sudo apt upgrade -y
```
Cài các công cụ cần thiết: 
```bash
sudo apt install wget unzip -y
```
## 2) Cài Apache (web server)
```bash
sudo apt install apache2 -y
sudo systemctl start apache2
sudo systemctl enable apache2
sudo systemctl status apache2
```
## 2.1) Cài đặt PHP
```bash
sudo apt update
sudo apt install software-properties-common -y
sudo add-apt-repository ppa:ondrej/php -y
sudo apt install php -y
```

## 3) Cài MySQL (hoặc MariaDB)
```bash
sudo apt install mysql-server -y
sudo mysql_secure_installation
sudo systemctl start mysql.service
sudo systemctl status mysql.service
```
- Tuy nhiên nếu chỉ cài đặt như vậy sẽ vẫn có lỗi:
- Lỗi này 100% do bạn chưa cài extension `php8.4-mysql` / `php-mysql` (trong đó có mysqli), nên WordPress không kết nối được MySQL.

Dù PHP-FPM đã chạy đúng, nhưng PHP chưa có module MySQL → WordPress báo lỗi này.
- Chạy thêm các lệnh sau để hoàn tất cài đặt:
```bash
sudo apt install php8.4-mysql -y
```
- Kiểm tra sau khi cài đặt xong
```bash
php -v
```
- Restart PHP-FPM:
```bash
sudo apt install php8.4-fpm
sudo systemctl restart php8.4-fpm
```
- Kiểm tra xem đã có mysqli đã chạy chưa :
```bash
php -m | grep mysql
```
Đăng nhập vào tài khoản `root` của database:
```bash
mysql -u root -p
```

Terminal chuyển sang mysql
- Tạo Database cho WP. Ở đây đặt là `group51`
```mysql
CREATE DATABASE group51;
```
- Tạo tài khoản riêng để quản lí DB. Tên tài khoản: `admin`, Mật khẩu: `admin`
```mysql
CREATE USER admin@localhost IDENTIFIED BY 'admin';
```
- Cấp quyền quản lý cơ sở dữ liệu cho user mới tạo:
```mysql
GRANT ALL PRIVILEGES ON group51.* TO admin@localhost;
```
- Xác thực những thay đổi về quyền:
```mysql
FLUSH PRIVILEGES;
```
**lưu ý**: `GRANT` không còn cho phép tạo user + đặt mật khẩu trong cùng 1 câu lệnh nữa trên MySQL 8 trở lên (Ubuntu, XAMPP, Windows đều vậy).
- Thoát khỏi mysql
```mysql
exit
```

### 3.1 Sửa lỗi không thể `mysql -u root -p`
- MySQL root đang dùng auth_socket (Ubuntu mặc định)
```plaintext
sudo mysql
```
Đổi thành dùng password
```bash
ALTER USER 'root'@'localhost'
IDENTIFIED WITH mysql_native_password BY 'yourpassword';

FLUSH PRIVILEGES;
```
Thoát và Test là thành công.

Hoặc bạn cũng có thể tạo USER mới
```mysql
CREATE USER 'admin'@'localhost' IDENTIFIED BY '123456';
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
```
## 4. Áp dụng cho User ngoài local host
- Login MySQL trên server DB:
```bash
mysql -u root -p
SHOW DATABASES;
```
- Cấp quyền cho ALL
```mysql
GRANT ALL PRIVILEGES ON group51.* TO 'root'@'%';
FLUSH PRIVILEGES;
```
- Check
```mysql
SELECT Host, User FROM mysql.user WHERE User='root';
```
Nó phải có hiện
```mysql
root | localhost
root | @
``` 
Nếu chỉ có mỗi dòng đầu -> IP khác không truy cập được chỉ có root từ local nó sẽ từ chối tất cả root từ nơi khác.
- Cho phép tất cả User from others IP
```mysql
CREATE USER 'root'@'%' IDENTIFIED BY '12345678';
GRANT ALL PRIVILEGES ON group51.* TO 'root'@'%';
FLUSH PRIVILEGES;
```
An toàn nhất
```mysql
CREATE USER 'root'@'ip máy cho phép' IDENTIFIED BY '12345678';
GRANT ALL PRIVILEGES ON group5.* TO 'root'@'ip máy cho phép';
FLUSH PRIVILEGES;
```
Test lại
```bash
mysql -u root -p -h 44.210.85.81
```
### 4.1 Cho phép không chỉ IP mặc định
- Mysql mặc định không cho Remote
```bash
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
```
- Check kỹ dòng
```mysql
bind-address = 127.0.0.1
```
- Đổi `127.0.0.1` sang `0.0.0.0` hoặc Ip cụ thể
- Restart
```bash
sudo systemctl restart mysql
``` 
- Test trực tiếp
```bash
mysql -u root -p -h 44.210.85.81 -P 3306
```
- Kiểm tra cổng
```bash
sudo ss -lntp | grep 3306
```

## Cài đặt phpmyadmin
- Cài đặt Kho lưu trữ EPEL(options)
```bash
yum install -y epel-release 
```
- Cài đặt phpmyadmin
```bash
sudo apt install phpmyadmin -Y
```
- Trong lúc cài đặt nó sẽ hỏi bạn có setup phpmyadmin cho website kiểu Apache2 hay lightpd tích cả 2
- Cài đặt Enable Php extension(options)
```bash
sudo phpenmod mbstring
sudo systemctl restart apache2
```
- Kiểm tra giới hạn Ip truy cập phpmyadmin
```bash
sudo nano /etc/apache2/conf-available/phpmyadmin.conf
```